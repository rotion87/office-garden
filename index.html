<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>ä¸Šç­å·é–’å°èŠ±åœ’ï½œDOS æ–‡å­—å†’éšªç‰ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { box-sizing: border-box; }

    body {
      margin:0;
      padding:12px;
      background:#000;
      color:#e5e5e5;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:13px;
    }

    .wrap {
      max-width:900px;
      margin:0 auto;
      border:1px solid #777;
      padding:8px;
    }

    .topbar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid #555;
      padding-bottom:4px;
      margin-bottom:4px;
    }

    .title {
      font-weight:bold;
      text-transform:uppercase;
      letter-spacing:1px;
    }

    .subtitle {
      font-size:11px;
      color:#b0b0b0;
    }

    button {
      font-family:inherit;
      font-size:11px;
      padding:2px 8px;
      border:1px solid #888;
      background:#111;
      color:#e5e5e5;
      cursor:pointer;
    }

    button:hover {
      background:#222;
    }

    .btn-stealth {
      text-transform:uppercase;
    }

    .main {
      display:flex;
      gap:8px;
    }

    .panel {
      border:1px solid #666;
      padding:6px;
    }

    .panel-left { flex:2; }
    .panel-right { flex:1; }

    .panel-title {
      font-weight:bold;
      margin-bottom:4px;
      border-bottom:1px solid #555;
      padding-bottom:2px;
      text-transform:uppercase;
      font-size:11px;
    }

    .status {
      font-size:11px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-bottom:4px;
    }

    .status span {
      border:1px solid #555;
      padding:1px 4px;
    }

    .extraStatus {
      font-size:11px;
      color:#c0c0c0;
      margin-bottom:4px;
      line-height:1.4;
    }

    .log {
      border:1px solid #555;
      padding:4px;
      height:220px;
      overflow-y:auto;
      white-space:pre-wrap;
      background:#050505;
      font-size:12px;
    }

    .controls {
      margin-top:4px;
      display:flex;
      flex-wrap:wrap;
      gap:4px;
    }

    .hint {
      font-size:10px;
      color:#9a9a9a;
      margin-top:3px;
    }

    .achv-list {
      font-size:11px;
      line-height:1.4;
    }

    .achv-item { margin-bottom:3px; }

    .achv-tag {
      display:inline-block;
      min-width:52px;
      border:1px solid #555;
      text-align:center;
      margin-right:4px;
      font-size:10px;
      padding:0 2px;
    }

    .achv-tag.locked {
      color:#777;
      border-color:#444;
    }

    .achv-tag.ok {
      color:#00ff66;
      border-color:#00ff66;
    }

    .achv-name {
      font-weight:bold;
    }

    .achv-desc {
      color:#b0b0b0;
      font-size:10px;
      margin-left:56px;
    }

    /* å½è£æ¨¡å¼ï¼šéš±è—éŠæˆ²ï¼Œç”¨å‡å·¥ä½œç•«é¢å–ä»£ */
    body.stealth .game-area { display:none; }
    body.stealth .stealth-area { display:block; }

    .stealth-area {
      display:none;
      border:1px solid #666;
      padding:6px;
      margin-top:4px;
      font-size:12px;
    }

    .fake-row {
      display:flex;
      justify-content:space-between;
      border-bottom:1px dashed #444;
      padding:2px 0;
    }

    .fake-label {
      color:#ccc;
    }

    .fake-value {
      color:#e5e5e5;
    }
  </style>
</head>
<body>
<div class="wrap">

  <div class="topbar">
    <div>
      <div class="title">OFFICE GARDEN / TEXT RPG</div>
      <div class="subtitle">ä¸Šç­å·é–’å°èŠ±åœ’ã€€â”€â”€ DOS é¢¨å°è¦–çª—ï¼Œå…§å»ºè¢«æŠ“åŒ…é¢¨éšªï¼†é‡ä¾†æ©Ÿåˆ¶</div>
    </div>
    <button class="btn-stealth" id="toggleStealth">STEALTH MODE</button>
  </div>

  <!-- éŠæˆ²ç•«é¢ -->
  <div class="game-area">
    <div class="main">
      <!-- å·¦å´ï¼šä¸»éŠæˆ² -->
      <div class="panel panel-left">
        <div class="panel-title">GARDEN STATUS</div>
        <div class="status" id="statusBar"></div>
        <div class="extraStatus" id="extraStatus"></div>
        <div class="log" id="logBox"></div>
        <div class="controls">
          <button id="btnPlant">[Z] ç¨®ä¸€é¡†ç¨®å­</button>
          <button id="btnWater">[X] å·¡è¦–ï¼‹æ¾†æ°´</button>
          <button id="btnRest">[C] æ”¾ç©ºä¸€ä¸‹</button>
          <button id="btnNext">[V] çµæŸä»Šå¤©</button>
        </div>
        <div class="hint">
          ç†±éµï¼šZ=ç¨®æ¤ã€€X=æ¾†æ°´ã€€C=æ”¾ç©ºã€€V=ä¸‹ä¸€å¤©ã€€S=å½è£æ¨¡å¼<br>
          éŠæˆ²æœƒå­˜åˆ°é€™å°é›»è…¦è£¡ï¼Œè¢«æŠ“åŒ…çš„è©±æœƒæ•´å±€é‡ä¾†ã€‚
        </div>
      </div>

      <!-- å³å´ï¼šæˆå°± -->
      <div class="panel panel-right">
        <div class="panel-title">ACHIEVEMENT</div>
        <div class="achv-list" id="achvList"></div>
      </div>
    </div>
  </div>

  <!-- å½è£ç•«é¢ï¼šçœ‹èµ·ä¾†å¾ˆåƒåœ¨çœ‹å·¥ä½œé€²åº¦ -->
  <div class="stealth-area">
    <div class="panel-title">DAILY WORK SUMMARY</div>
    <div class="fake-row">
      <div class="fake-label">é …ç›® 01</div>
      <div class="fake-value">æª¢æŸ¥æœ¬é€±å°ˆæ¡ˆé€²åº¦</div>
    </div>
    <div class="fake-row">
      <div class="fake-label">é …ç›® 02</div>
      <div class="fake-value">æ•´ç†éŠ·å”®æ•¸å­—ï¼†KPI</div>
    </div>
    <div class="fake-row">
      <div class="fake-label">é …ç›® 03</div>
      <div class="fake-value">è¦åŠƒä¸‹é€±å¾…è¾¦æ¸…å–®</div>
    </div>
    <div class="fake-row">
      <div class="fake-label">é …ç›® 04</div>
      <div class="fake-value">å›è¦†åŒäº‹è¨Šæ¯èˆ‡éœ€æ±‚</div>
    </div>
    <div class="hint">
      â€» çœ‹èµ·ä¾†å¾ˆåƒå·¥ä½œç•«é¢ï¼Œå…¶å¯¦åªæ˜¯æš«åœéŠæˆ²ã€‚å†æŒ‰ä¸€æ¬¡ã€ŒSTEALTH MODEã€å°±èƒ½å›åˆ°èŠ±åœ’ç¹¼çºŒå·é–’ã€‚
    </div>
  </div>

</div>

<script>
  // =============================
  //         åŸºæœ¬ç‹€æ…‹
  // =============================
  const SAVE_KEY = "officeGardenTextRPG_DOS_TW_gameover";

  let state = {
    day: 1,
    energy: 3,
    seeds: 3,
    plants: [],         // {id,name,stage,health}
    totalPlanted: 0,    // ç´¯è¨ˆç¨®éå¹¾é¡†
    stealthCount: 0,    // ä¸Šç­å½è£æ¬¡æ•¸
    activeTime: 0,      // éŠæˆ²ç•«é¢ç´¯ç©ç§’æ•¸
    suspicion: 0,       // 0â€“100 è¢«æŠ“åŒ…é¢¨éšª
    achievementsUnlocked: [],
    logIntroShown: false,
    gameOver: false     // æ˜¯å¦å·²ç¶“ GAME OVER
  };

  // è¼‰å…¥å­˜æª”
  const saved = localStorage.getItem(SAVE_KEY);
  if (saved) {
    try {
      const parsed = JSON.parse(saved);
      Object.assign(state, parsed);
      if (state.totalPlanted == null) state.totalPlanted = 0;
      if (state.stealthCount == null) state.stealthCount = 0;
      if (state.activeTime == null) state.activeTime = 0;
      if (state.suspicion == null) state.suspicion = 0;
      if (!Array.isArray(state.achievementsUnlocked)) state.achievementsUnlocked = [];
      if (state.gameOver == null) state.gameOver = false;
    } catch(e) {
      console.warn("å­˜æª”å£æ‰ï¼Œæ”¹ç”¨é è¨­å€¼");
    }
  }

  const statusBar = document.getElementById("statusBar");
  const extraStatus = document.getElementById("extraStatus");
  const logBox = document.getElementById("logBox");
  const achvList = document.getElementById("achvList");

  function saveGame() {
    localStorage.setItem(SAVE_KEY, JSON.stringify(state));
  }

  function log(text) {
    const prefix = `DAY ${state.day} > `;
    logBox.textContent += prefix + text + "\n";
    logBox.scrollTop = logBox.scrollHeight;
    saveGame();
  }

  function formatTime(sec) {
    const h = Math.floor(sec / 3600);
    const m = Math.floor((sec % 3600) / 60);
    const s = sec % 60;
    return `${h}å°æ™‚ ${m}åˆ† ${s}ç§’`;
  }

  function clampSuspicion() {
    state.suspicion = Math.max(0, Math.min(100, state.suspicion));
  }

  function addSuspicion(v) {
    state.suspicion += v;
    clampSuspicion();
  }

  function updateStatus() {
    const plantCount = state.plants.length;
    const mature = state.plants.filter(p => p.stage >= 3).length;

    statusBar.innerHTML = `
      <span>ç¬¬ ${state.day} å¤©</span>
      <span>é«”åŠ› ${state.energy}/3</span>
      <span>ç¨®å­ ${state.seeds}</span>
      <span>æ¤ç‰© ${plantCount}</span>
      <span>æˆç†Ÿ ${mature}</span>
      <span>é¢¨éšª ${state.suspicion}/100</span>
    `;

    extraStatus.innerHTML = `
      ä¸Šç­å½è£æ¬¡æ•¸ï¼š${state.stealthCount} æ¬¡<br>
      åœ¨èŠ±åœ’å·é–’æ™‚é–“ï¼š${formatTime(state.activeTime)}<br>
      ç´¯è¨ˆç¨®ä¸‹ç¨®å­ï¼š${state.totalPlanted} é¡†
    `;
  }

  function initIntro() {
    if (state.logIntroShown) return;
    log("ä½ åœ¨è¢å¹•çš„ä¸€å°è§’ï¼Œé–‹äº†ä¸€å€‹åªå±¬æ–¼è‡ªå·±çš„ã€ä¸Šç­å·é–’å°èŠ±åœ’ã€ã€‚");
    log("å¤–é¢çœ‹èµ·ä¾†æ˜¯å·¥ä½œè¦–çª—ï¼Œå…¶å¯¦è£¡é¢æ‚„æ‚„ç¨®è‘—å¹¾é¡†åªæœ‰ä½ çŸ¥é“çš„æ¤ç‰©ã€‚");
    log("åªæ˜¯è¦å°å¿ƒï¼Œå·é–’å·å¤ªå…‡ï¼Œä¸»ç®¡ç¸½æœ‰ä¸€å¤©æœƒè¦ºå¾—ä½ æ€ªæ€ªçš„ã€‚");
    state.logIntroShown = true;
  }

  // =============================
  //       æˆå°±ç³»çµ±
  // =============================
  const ACHIEVEMENTS = [
    {
      id: "first_plant",
      name: "ç¬¬ä¸€é¡†å…ˆç¨®å†èªª",
      desc: "ç¨®ä¸‹äººç”Ÿï¼ˆï¼Ÿï¼‰ç¬¬ä¸€é¡†å·é–’ç”¨çš„ç¨®å­ã€‚",
      check: (s) => s.totalPlanted >= 1
    },
    {
      id: "ten_plants",
      name: "å°èŠ±åœ’ç®¡ç†å“¡",
      desc: "ç´¯è¨ˆç¨®ä¸‹ 10 é¡†ä»¥ä¸Šçš„ç¨®å­ï¼Œé–‹å§‹æœ‰é»èªçœŸç¶“ç‡Ÿã€‚",
      check: (s) => s.totalPlanted >= 10
    },
    {
      id: "stealth_5",
      name: "å½è£è€æ‰‹",
      desc: "å•Ÿå‹•ä¸Šç­å½è£æ¨¡å¼ 5 æ¬¡ä»¥ä¸Šï¼Œåˆ‡æ›è¦–çª—éå¸¸ç†Ÿç·´ã€‚",
      check: (s) => s.stealthCount >= 5
    },
    {
      id: "time_10min",
      name: "å·é–’å°ˆæ¥­æˆ¶",
      desc: "åœ¨èŠ±åœ’ç•«é¢è£¡å¾…æ»¿ 10 åˆ†é˜ï¼Œæ··å¾—å¾ˆå®‰éœä½†å¾ˆå¾¹åº•ã€‚",
      check: (s) => s.activeTime >= 600
    },
    {
      id: "day_10",
      name: "åŠ ç­æˆ°å£«",
      desc: "åœ¨é€™å€‹èŠ±åœ’è£¡æ´»é 10 å¤©ï¼Œä»£è¡¨ä½ ä¸Šç­ä¹Ÿæ´»éäº†ä¸å°‘å¤©ã€‚",
      check: (s) => s.day >= 10
    },
    {
      id: "safe_farmer",
      name: "ç©©ç©©å·é–’",
      desc: "åŒæ™‚æ“æœ‰è‡³å°‘ 5 æ ªæ¤ç‰©ï¼Œé¢¨éšªé‚„ç¶­æŒåœ¨ 40 ä»¥ä¸‹ã€‚",
      check: (s) => s.plants.length >= 5 && s.suspicion < 40
    }
  ];

  function renderAchievements() {
    achvList.innerHTML = "";
    ACHIEVEMENTS.forEach(a => {
      const unlocked = state.achievementsUnlocked.includes(a.id);
      const div = document.createElement("div");
      div.className = "achv-item";
      div.innerHTML = `
        <span class="achv-tag ${unlocked ? "ok" : "locked"}">
          ${unlocked ? "å·²è§£é–" : "æœªè§£é–"}
        </span>
        <span class="achv-name">${a.name}</span>
        <div class="achv-desc">${a.desc}</div>
      `;
      achvList.appendChild(div);
    });
  }

  function checkAchievements() {
    let unlockedAny = false;
    ACHIEVEMENTS.forEach(a => {
      if (!state.achievementsUnlocked.includes(a.id) && a.check(state)) {
        state.achievementsUnlocked.push(a.id);
        log(`ğŸ“ æˆå°±è§£é–ï¼š${a.name}`);
        unlockedAny = true;
      }
    });
    if (unlockedAny) {
      renderAchievements();
      saveGame();
    }
  }

  // =============================
  //        GAME OVER / é‡ä¾†
  // =============================
  function resetGame() {
    localStorage.removeItem(SAVE_KEY);
    location.reload();
  }

  function triggerGameOver() {
    if (state.gameOver) return;
    state.gameOver = true;
    log("ğŸ•¶ï¸ ä»Šå¤©ä¸»ç®¡çªç„¶å«ä½ å»å°æˆ¿é–“èŠèŠï¼Œèªæ°£éå¸¸é—œå¿ƒä½†çœ¼ç¥ä¸å¤ªå°å‹ã€‚");
    log("ä½ éš±ç´„æ„Ÿè¦ºåˆ°ï¼Œæœ€è¿‘å·é–’å·å¤ªå…‡é€™ä»¶äº‹ï¼Œçµ‚æ–¼é‚„æ˜¯è¢«çœ‹å‡ºä¾†äº†ã€‚");
    log("ä½ çš„å·é–’å°èŠ±åœ’è¢«è¿«é—œé–‰ï¼Œåªå‰©ä¸‹é»‘è‰²çš„è¢å¹•å€’æ˜ è‘—ä½ çš„è‡‰ã€‚");

    saveGame();

    setTimeout(() => {
      alert("ä½ è¢«ä¸»ç®¡æ­£å¼æŠ“åŒ…ï¼Œé€™ä¸€è¼ªéŠæˆ²çµæŸï¼Œæº–å‚™é‡æ–°é–‹å§‹ã€‚");
      resetGame();
    }, 300);
  }

  // =============================
  //        è¡Œç‚ºé‚è¼¯
  // =============================
  function ensureAlive() {
    if (state.gameOver) {
      log("ç³»çµ±ï¼šé€™ä¸€è¼ªå·²ç¶“çµæŸäº†ï¼Œè«‹é‡æ–°æ•´ç†æˆ–ç­‰è‡ªå‹•é‡ä¾†ã€‚");
      return false;
    }
    return true;
  }

  function doPlant() {
    if (!ensureAlive()) return;
    if (state.energy <= 0) return log("ä½ ä»Šå¤©å·²ç¶“æ‡¶åˆ°é€£å½è…°ç¨®æ±è¥¿éƒ½ä¸æƒ³ã€‚");
    if (state.seeds <= 0) return log("å£è¢‹ç¿»ä¸€åœˆï¼Œä»Šå¤©çš„ç¨®å­å·²ç¶“å…¨ç”¨å…‰äº†ã€‚");
    if (state.plants.length >= 8) return log("é€™å¡Šå°è§’è½æš«æ™‚å®¹ä¸ä¸‹æ›´å¤šæ¤ç‰©ï¼Œå¤ªæ˜é¡¯æœƒè¢«ç™¼ç¾ã€‚");

    state.energy--;
    state.seeds--;
    state.totalPlanted++;
    addSuspicion(10); // ç¨®æ±è¥¿å¾ˆæ˜é¡¯åœ¨å·é–’

    const names = ["æ¡Œè§’å°è‰", "æœƒè­°å®¤ç›†æ ½", "åŠ ç­ä»™äººæŒ", "å’–å•¡æ¨¹è‹—", "çª—é‚Šå°è‘‰å­"];
    const plant = {
      id: Date.now(),
      name: names[Math.floor(Math.random()*names.length)],
      stage: 0,
      health: 70 + Math.floor(Math.random()*30)
    };
    state.plants.push(plant);

    log(`ä½ è¶å¤§å®¶ä¸æ³¨æ„ï¼Œæ‚„æ‚„ç¨®ä¸‹äº†ã€Œ${plant.name}ã€ã€‚é¢¨éšªå¾®å¾®ä¸Šå‡ã€‚`);
    updateStatus();
    checkAchievements();
  }

  function doWater() {
    if (!ensureAlive()) return;
    if (state.energy <= 0) return log("ä½ æ‹¿èµ·æ°´å£ºï¼Œåˆæ”¾å›å»ã€‚è¦ºå¾—ä»Šå¤©å°±å…ˆé€™æ¨£å§ã€‚");
    if (state.plants.length === 0) return log("èŠ±åœ’è£¡é‚„ç©ºç©ºçš„ï¼Œåªæœ‰åœŸè·Ÿä½ çš„ä¸Šç­éˆé­‚ã€‚");

    state.energy--;
    addSuspicion(8); // å·¡è¦–ï¼‹æ¾†æ°´ä¹Ÿç®—å·é–’

    let txt = "ä½ å‡è£åœ¨æƒ³ç°¡å ±å…§å®¹ï¼Œå…¶å¯¦åœ¨å¹«æ¯ä¸€æ ªæ¤ç‰©æ¾†æ°´ï¼š\n";
    state.plants.forEach(p => {
      const add = 5 + Math.floor(Math.random()*6);
      p.health = Math.min(100, p.health + add);
      txt += `  â€¢ ${p.name} çœ‹èµ·ä¾†æœ‰ç²¾ç¥å¤šäº†ï¼ˆ+${add}ï¼‰ã€‚\n`;
    });
    log(txt.trim());
    updateStatus();
    checkAchievements();
  }

  function doRest() {
    if (!ensureAlive()) return;
    if (state.energy <= 0) return log("ä½ å·²ç¶“åœ¨æ”¾ç©ºäº†ï¼Œå†æ”¾ä¸‹å»å¯èƒ½æœƒç›´æ¥ç¡è‘—ã€‚");
    state.energy = 0;
    addSuspicion(6); // æ˜é¡¯æ²’åœ¨å·¥ä½œ

    const msgs = [
      "ä½ ç›¯è‘—è¢å¹•ä¸Šçš„æ•¸å­—ï¼Œå¯¦éš›ä¸Šè…¦è¢‹æ•´å€‹æ”¾ç©ºã€‚",
      "ä½ æ‰“é–‹ä¸€ä»½çœ‹èµ·ä¾†å¾ˆé‡çš„ Excelï¼Œçµæœåªæ˜¯è®“å®ƒç•¶èƒŒæ™¯ã€‚",
      "è€³æ©Ÿè£¡æ”¾è‘—æ­Œï¼Œä½ å‡è£åœ¨æ‰“å­—ï¼Œå…¶å¯¦åªæ˜¯åœ¨è·Ÿè‘—ç¯€å¥æ•²éµç›¤ã€‚"
    ];
    log(msgs[Math.floor(Math.random()*msgs.length)]);
    updateStatus();
    checkAchievements();
  }

  // =============================
  //    æ ¹æ“šé¢¨éšªè§¸ç™¼äº‹ä»¶ï¼ˆåŒ…å« GAME OVERï¼‰
  // =============================
  function handleSuspicionAndEvents() {
    if (state.suspicion >= 100) {
      triggerGameOver();
      return;
    }

    // ä¸€èˆ¬éš¨æ©Ÿäº‹ä»¶
    const r = Math.random();

    if (r < 0.2) {
      state.seeds += 1;
      log("ä½ åœ¨æ¡Œä¸Šè§’è½ç™¼ç¾ä¸€é¡†ä¸çŸ¥é“ä»€éº¼æ™‚å€™æ‰çš„ç¨®å­ï¼Œå°±é †æ‰‹æ’¿èµ·ä¾†æ”¶è‘—ã€‚");
    } else if (r < 0.4 && state.plants.length > 0) {
      const p = state.plants[Math.floor(Math.random()*state.plants.length)];
      const loss = 10 + Math.floor(Math.random()*11);
      p.health -= loss;
      if (p.health <= 0) {
        log(`${p.name} æ’ä¸éé€™å¹¾å¤©çš„ç’°å¢ƒï¼Œé»˜é»˜åœ°æ¯æ‰äº†ã€‚`);
        state.plants = state.plants.filter(x => x.id !== p.id);
      } else {
        log(`æŸå€‹æ™šä¸Šï¼Œå¥½åƒæœ‰èŸ²å­ä¾†é–‹è¶´ï¼Œã€Œ${p.name}ã€è¢«å’¬å¾—äº‚ä¸ƒå…«ç³Ÿï¼ˆ-${loss}ï¼‰ã€‚`);
      }
    } else if (r < 0.6 && state.plants.length > 0) {
      state.plants.forEach(p => {
        if (p.stage < 3) p.stage++;
      });
      log("å¤–é¢çªç„¶ä¸‹ä¸€å ´é›¨ï¼Œé›–ç„¶ä½ é‚„æ˜¯åœ¨è¾¦å…¬å®¤ï¼Œä½†æ¤ç‰©å€‘å¥½åƒä¹Ÿé•·å¤§äº†ä¸€é»ã€‚");
    } else {
      log("é€™å¤©å¹³å¹³æ·¡æ·¡éå»ï¼Œæ²’äººç™¼ç¾ä½ åœ¨é€™å€‹å°è¦–çª—è£¡å·é–’ã€‚");
    }
  }

  function nextDay() {
    if (!ensureAlive()) return;
    state.day++;
    state.energy = 3;

    // æ¯å¤©çµç®—é¢¨éšªï¼šç¨å¾®è‡ªç„¶ä¸‹é™
    state.suspicion = Math.max(0, state.suspicion - 15);

    handleSuspicionAndEvents();
    updateStatus();
    checkAchievements();
  }

  // =============================
  //   è¨ˆæ™‚ï¼ˆåªç®—éŠæˆ²ç•«é¢ï¼Œä¸ç®—å½è£ï¼‰
  // =============================
  setInterval(() => {
    if (!document.body.classList.contains("stealth") && !state.gameOver) {
      state.activeTime += 1;
      updateStatus();
      checkAchievements();
      saveGame();
    }
  }, 1000);

  // =============================
  //       å½è£æ¨¡å¼
  // =============================
  function toggleStealth() {
    const entering = !document.body.classList.contains("stealth");
    if (entering && !state.gameOver) {
      state.stealthCount++;
      // è£å¿™ä¸€ä¸‹ï¼Œé¢¨éšªç¨å¾®å¾€ä¸‹æ‰
      state.suspicion = Math.max(0, state.suspicion - 5);
      checkAchievements();
      saveGame();
    }
    document.body.classList.toggle("stealth");
    updateStatus();
  }

  document.getElementById("toggleStealth").addEventListener("click", toggleStealth);

  // =============================
  //     æŒ‰éˆ• & éµç›¤äº‹ä»¶
  // =============================
  document.getElementById("btnPlant").addEventListener("click", doPlant);
  document.getElementById("btnWater").addEventListener("click", doWater);
  document.getElementById("btnRest").addEventListener("click", doRest);
  document.getElementById("btnNext").addEventListener("click", nextDay);

  document.addEventListener("keydown", (e) => {
    if (e.key === "z" || e.key === "Z") doPlant();
    if (e.key === "x" || e.key === "X") doWater();
    if (e.key === "c" || e.key === "C") doRest();
    if (e.key === "v" || e.key === "V") nextDay();
    if (e.key === "s" || e.key === "S") toggleStealth();
  });

  // =============================
  //        åˆå§‹åŒ–
  // =============================
  initIntro();
  updateStatus();
  renderAchievements();
  if (!logBox.textContent.trim()) {
    log("ç³»çµ±å•Ÿå‹•ã€‚æ­¡è¿å›åˆ°ä½ çš„ä¸Šç­å·é–’å°èŠ±åœ’ã€‚");
  }
</script>
</body>
</html>
